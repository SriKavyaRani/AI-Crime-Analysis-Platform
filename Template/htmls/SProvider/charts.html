{% extends 'SProvider/Header.html' %}
{% block researchblock %}

<style>
    body {
        background-color: #FFFFFF;
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
    }
    
    .menu table {
        width: 100%;
        text-align: center;
        border-collapse: collapse;
    }
    
    .menu table td:hover {
        background: rgb(0, 0, 0);
        color: white;
        transition: background-color 0.3s ease;
    }
    
    .menu table td {
        background: #584b4f;
        color: white;
        padding: 15px;
        border: 1px solid #333;
    }
    
    .topic h1 {
        color: white;
        padding: 20px;
        text-align: center;
        border-style: none;
        background: linear-gradient(135deg, #584b4f, #333);
        margin: 0;
        width: 100%;
        box-sizing: border-box;
    }
    
    .container {
        display: flex;
        min-height: calc(100vh - 100px);
    }
    
    .sidemenu {
        width: 250px;
        background: #f5f5f5;
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
    }
    
    .sidemenu h3 {
        margin: 20px 0;
        color: #333;
    }
    
    .sidemenu a {
        display: block;
        padding: 15px 20px;
        margin: 10px 0;
        background: #584b4f;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }
    
    .sidemenu a:hover {
        background: #333;
    }
    
    .chart-content {
        margin-left: 270px;
        padding: 20px;
        flex: 1;
    }
    
    #chartContainer {
        width: 100%;
        height: 400px;
        margin: 20px 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .chart-title {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
        font-size: 24px;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
        .sidemenu {
            width: 100%;
            position: relative;
            height: auto;
        }
        
        .chart-content {
            margin-left: 0;
        }
        
        .container {
            flex-direction: column;
        }
        
        #chartContainer {
            height: 300px;
        }
    }
</style>

<script>
window.onload = function() {
    var chart = new CanvasJS.Chart("chartContainer", {
        animationEnabled: true,
        theme: "light2",
        title: {
            text: "Data Visualization - {{ chart_type|title }} Chart",
            fontSize: 20
        },
        axisY: {
            {% if chart_type == "line" or chart_type == "spline" %}
            title: "Values"
            {% endif %}
        },
        {% if chart_type == "line" or chart_type == "spline" %}
        axisX: {
            title: "Categories"
        },
        {% endif %}
        data: [{
            {% if chart_type == "line" %}
                type: "line",
                markerSize: 8,
                lineThickness: 3
            {% elif chart_type == "pie" %}
                type: "pie",
                startAngle: 240,
                yValueFormatString: "##0.00\"%\"",
                indexLabel: "{label}: {y}%",
                showInLegend: true,
                legendText: "{label}"
            {% elif chart_type == "spline" %}
                type: "spline",
                markerSize: 8,
                lineThickness: 3
            {% endif %}
            
            {% if chart_type == "pie" %}
            ,dataPoints: [
                {% for o in form %}
                    {y: {{ o.dcount }}, label: "{{ o.names|escape }}"},
                {% endfor %}
            ]
            {% else %}
            ,dataPoints: [
                {% for o in form %}
                    {x: {{ forloop.counter }}, y: {{ o.dcount }}, label: "{{ o.names|escape }}"},
                {% endfor %}
            ]
            {% endif %}
        }]
    });
    
    chart.render();
    
    // Error handling
    if (!chart) {
        document.getElementById('chartContainer').innerHTML = '<p style="text-align: center; color: red;">Error loading chart. Please check your data.</p>';
    }
};
</script>

<body>
    <div class="topic">
        <h1>Interactive Data Charts</h1>
    </div>
    
    <div class="container">
        <div class="sidemenu">
            <h3>Chart Types</h3>
            <a href="{% url 'charts' 'pie' %}">PIE CHART</a>
            <a href="{% url 'charts' 'line' %}">LINE CHART</a>
            <a href="{% url 'charts' 'spline' %}">SPLINE CHART</a>
            
            {% if form %}
            <h3>Data Summary</h3>
            <p>Total Records: {{ form|length }}</p>
            {% endif %}
        </div>
        
        <div class="chart-content">
            <h2 class="chart-title">{{ chart_type|title }} Chart Visualization</h2>
            
            {% if form %}
                <div id="chartContainer"></div>
            {% else %}
                <div style="text-align: center; padding: 50px; color: #666;">
                    <h3>No Data Available</h3>
                    <p>Please ensure your data is properly loaded.</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>

{% endblock %}